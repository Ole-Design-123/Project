@model IEnumerable<AppITInfo.Models.CoordCollegeViewModel>

@{
    ViewBag.Title = "Coordinator_Info";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<br />
<div class="col-lg-offset-2 col-lg-8">
    <h2 style="text-align:center">Division Report</h2>
    <br />
    <table id="DivReport" class="table table-striped table-bordered table-sm">
        <thead style="background-color:silver">
            <tr>
                <th scope="col">Stream</th>
                <th scope="col">Not Assigned</th>
                <th scope="col">Assigned</th>
                <th scope="col">Complete</th>
                <th scope="col">Incomplete</th>
                <th scope="col">Skipped</th>
            </tr>
        </thead>
        <tbody>
            @*<tr>
                    <td> @item.DivCode</td>
                    <td> @item.DivTotalPapers</td>
                    <td> @item.DivCompletePapers</td>
                    <td>@item.DivIncompletePapers</td>
                </tr>*@
        </tbody>
    </table>
</div>
<hr />
<div>
    <div class="row col-lg-6" style="margin-bottom: 30px">
        <h2>Index Numberwise Report</h2>
        <br />
        <table class="table table-striped table-bordered table-sm">
            <thead style="background-color:silver">
                <tr>
                    <th scope="col">Sr. No</th>
                    <th scope="col">TID</th>
                    <th scope="col">Stream</th>
                    <th scope="col">Total Papers</th>
                    <th scope="col">Complete</th>
                    <th scope="col">Incomplete</th>
                    <th scope="col">Skipped</th>

                </tr>
            </thead>
            @{int i = 1;}
            @foreach (var item in Model)
            {
                <tbody>
                    <tr>
                        <td>
                            <span>@i</span>
                            @{i++;}
                        </td>
                        <td> @item.TID</td>
                        <td> @item.stream</td>
                        <td> @item.TotalPapers</td>
                        <td> @item.CompletePapers</td>
                        <td>@item.IncompletePapers</td>
                        <td>@item.SkipPapers</td>
                    </tr>
                </tbody>
            }
        </table>
    </div>
    <div class="row col-lg-6" style="margin-left:15px; margin-bottom:20px">
        <h2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Search Report by Index No</h2>
        <br />
        <div class="col-md-offset-1 col-md-5">
            <input id="IndexNo" type="text" class="form-control" name="IndexNo" placeholder="Enter TID / Index No" required>
            <br />
            <br />
        </div>
        <div class="col-md-2">
            <input type="submit" id="btnSearch" value="Search" class="btn btn-primary" />
        </div>
        <div class="col-md-offset-1">
            <table id="DataSearching" class="table table-striped table-bordered table-sm">
                <thead style="background-color:silver">
                    <tr>
                        <th scope="col">TID</th>
                        <th scope="col">Total Papers</th>
                        <th scope="col">Complete</th>
                        <th scope="col">Incomplete</th>
                        <th scope="col">Skipped</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>
        <br />
        <div class="col-md-offset-1">
            <div class="col-md-12" id="AssignPaper" style="display:none">
                <table>
                    <tr>
                        <td colspan="3"><input type="submit" id="btnClearSkip" value="Clear skipped rack" class="btn btn-warning" /></td>
                    </tr>
                    <tr>
                        <td><label id="lblName"> </label></td>
                        <td style="padding:10px"> <input id="PapersCnt" type="text" class="form-control" name="PapersCnt" placeholder="Enter no. of papers" required></td>
                        <td></td>
                    </tr>
                </table>
            </div>
        </div>
        <br />
        <div class="col-md-offset-1">
            <div class="col-md-12" id="stream" style="display:none">
                <label>Select Stream :- </label>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <input type="checkbox" id="Arts" name="chk_stream" value="Arts" class="example">
                <label for="Arts"> Arts</label>&nbsp;&nbsp;&nbsp;
                <input type="checkbox" id="Commerce" name="chk_stream" value="Commerce" class="example">
                <label for="Commerce">Commerce</label>&nbsp;&nbsp;&nbsp;
                <input type="checkbox" id="Science" name="chk_stream" value="Science" class="example">
                <label for="Science"> Science </label>
                <input type="submit" id="btnAssign" value="Assign" class="btn btn-success " />
            </div>
        </div>
    </div>
</div>
<script src="~/Scripts/jquery-3.4.1.min.js"></script>
<script>
    $(document).ready(function () {
        $.ajax({
            type: "GET",
            url: '/Coordinator/getDivReport',
            datatype: 'json',
            success: function (data) {
                var items = '';
                $.each(data, function (i, item) {

                    var rows = "<tr>" +
                        "<td >" + item.Stream + "</td>" +
                        "<td >" + item.DivNotAssignedPapers + "</td>" +
                        "<td >" + item.DivAssignedPapers + "</td>" +
                        "<td >" + item.DivCompletePapers + "</td>" +
                        "<td >" + item.DivIncompletePapers + "</td>" +
                        "<td >" + item.DivSkipPapers + "</td>" +
                        +"</tr>";

                    $('#DivReport tbody').append(rows);

                    $("#loading-image").hide();
                });
            },
        });
    });

    $(document).ready(function () {
        $('input.example').on('change', function () {
            $('input.example').not(this).prop('checked', false);
        });
        $("#btnSearch").click(function () {
            //Reference the Label.
            var lblName = document.getElementById("lblName");
            //Copy the TextBox value to Label.
            lblName.innerHTML = "Assign Paper to " + $("#IndexNo").val();

            $('#DataSearching tbody tr').remove();
            $.ajax({
                type: 'Post',
                url: '/Coordinator/getSearchingData',
                data: {
                    SearchValue: $("#IndexNo").val()
                },
                dataType: 'json',
                success: function (data) {
                    if (data.success == false) {
                        Error_Alert(data.message);
                        var rows = "<tr style='color:red;'> " +
                            '<td colspan = "5"> No record found</td>' +
                            +"</tr>";
                        $("#AssignPaper").hide();
                        $("#stream").hide();
                        $('#DataSearching tbody').append(rows);
                    }
                    else {
                        var items = '';
                        $.each(data, function (i, item) {
                            if (item.sch != 0) {
                                $("#AssignPaper").show();
                                $("#stream").show();
                                var rows = "<tr style='color:" + item.ColorStatus + ";'> " +
                                    
                                    +"</tr>";
                                $('#DataSearching tbody').append(rows);
                            }
                            $("#loading-image").hide();
                        });
                    }
                },
                error: function (ex) {

                }
            });
        });
    });

    $(document).ready(function () {
        $("#btnClearSkip").click(function () {
            $.ajax({
                type: 'Post',
                url: '/Coordinator/clearSkipPaper',
                data: {
                    IndexNo: $("#IndexNo").val()
                },
                dataType: 'json',
                success: function (data) {
                    if (data.Result == "Cleared") {
                        window.location = "../Coordinator/Coordinator_info";
                        alert(data.Message);
                    }
                    if (data.Result == "Failed") {
                        alert(data.Message);
                    }
                },
                error: function (ex) {

                }
            });
        });
    });

    $(document).ready(function () {
        window.onunload = function () { null };
        setTimeout("preventBack()", 0);
        $("#btnAssign").click(function () {
            $.ajax({
                type: 'Post',
                url: '/Coordinator/paperAssign',
                data: {
                    PaperCount: $("#PapersCnt").val(),
                    TID: $("#IndexNo").val(),
                    Stream: $("input[name='chk_stream']:checked").val()
                },
                dataType: 'json',
                success: function (data) {
                    if (data.Result == "Updated") {
                        window.location = "../Coordinator/Coordinator_info";
                        console.log("Checked");
                        alert(data.Message);
                    }
                    if (data.Result == "Failed") {
                        alert(data.Message);
                    }
                    if (data.success == false) {
                        Error_Alert(data.message);
                    }
                },
                error: function (ex) {
                }
            });
        });
    });

    function Success_Alert(MSG) {
        Swal.fire({
            icon: 'success',
            title: MSG,
            showConfirmButton: false,
            timer: 3000
        })
    }
    function Error_Alert(MSG) {

        Swal.fire({
            icon: 'error',
            title: MSG,
            showConfirmButton: false,
            timer: 3000
        })
    }
</script>

<script type="text/javascript">
    function preventBack() { window.history.forward(); }
    setTimeout("preventBack()", 0);
   
</script>